global
    log stdout format raw local0
    maxconn 5000

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5s
    timeout client  30s
    timeout server  30s

resolvers dns
    parse-resolv-conf
    resolve_retries 3
    timeout retry   1s
    hold valid     10s

frontend fe_main
    # Bind to $PORT with default 8080 if not set
    bind "0.0.0.0:${PORT-8080}"
    mode http
    default_backend be_vad

backend be_vad
    mode http
    balance roundrobin

    # HTTP health check on /health
    option httpchk GET /health
    http-check expect status 200

    # Single backend server on internal port 8000
    server vad "vad-service-2.railway.internal:8000" \
        check inter 3s rise 2 fall 3 resolvers dns